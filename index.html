<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Match Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            background: linear-gradient(to bottom, #c084fc, #ec4899);
        }
        #header {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9333ea;
        }
        .stats {
            display: flex;
            gap: 2rem;
        }
        .stat {
            text-align: center;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #4b5563;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .score { color: #9333ea; }
        .moves { color: #ec4899; }
        .time { color: #10b981; }
        .time.warning { color: #dc2626; }
        #gameCanvas {
            width: 100%;
            height: calc(100vh - 80px);
            display: block;
            cursor: pointer;
        }
        .overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
        }
        .overlay h2 {
            font-size: 2rem;
            color: #9333ea;
            margin-bottom: 1rem;
        }
        .overlay p {
            color: #4b5563;
            margin-bottom: 1.5rem;
        }
        .overlay button {
            background: #9333ea;
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(147, 51, 234, 0.3);
        }
        .overlay button:hover {
            background: #7e22ce;
            transform: scale(1.05);
        }
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 1.5rem 2.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            font-size: 1.5rem;
            font-weight: bold;
            color: #9333ea;
            z-index: 999;
            animation: bounce 0.5s ease;
        }
        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
        .hidden { display: none; }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            z-index: 2000;
        }
    </style>
</head>
<body>
    <div id="loading">Loading game...</div>
    
    <div id="header">
        <div class="header-content">
            <div class="title">üêæ Animal Match</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Score</div>
                    <div class="stat-value score" id="score">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Moves</div>
                    <div class="stat-value moves" id="moves">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Time</div>
                    <div class="stat-value time" id="time">90s</div>
                </div>
            </div>
        </div>
    </div>

    <div id="gameCanvas"></div>

    <div id="startOverlay" class="overlay">
        <h2>üêæ Animal Match Game</h2>
        <p>Find all 8 matching pairs!</p>
        <button onclick="startGame()">‚ñ∂Ô∏è Start Game</button>
    </div>

    <div id="gameOverOverlay" class="overlay hidden">
        <h2>üéÆ Game Over!</h2>
        <p id="finalStats"></p>
        <p>Play again?</p>
        <button onclick="startGame()">üîÑ Play Again</button>
    </div>

    <div id="message" class="message hidden"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Wait for Three.js to load
        function waitForThree() {
            return new Promise((resolve) => {
                if (typeof THREE !== 'undefined') {
                    resolve();
                } else {
                    setTimeout(() => waitForThree().then(resolve), 100);
                }
            });
        }

        waitForThree().then(() => {
            document.getElementById('loading').style.display = 'none';
            initGame();
        });

        let scene, camera, renderer;
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;
        let raycaster;
        let mouse;
        let score = 0;
        let moves = 0;
        let timeLeft = 90;
        let gameStarted = false;
        let gameOver = false;
        let timerInterval = null;

        const animals = [
            { emoji: 'üê∂', color: 0xff6b6b },
            { emoji: 'üê±', color: 0x4ecdc4 },
            { emoji: 'üê≠', color: 0xffe66d },
            { emoji: 'üêπ', color: 0xa8e6cf },
            { emoji: 'üê∞', color: 0xff8b94 },
            { emoji: 'ü¶ä', color: 0xffa07a },
            { emoji: 'üêª', color: 0x98d8c8 },
            { emoji: 'üêº', color: 0xc7ceea }
        ];

        function initGame() {
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            const container = document.getElementById('gameCanvas');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 12, 8);
            camera.lookAt(0, 0, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 5);
            dirLight.castShadow = true;
            scene.add(dirLight);
            
            const groundGeometry = new THREE.PlaneGeometry(30, 30);
            const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x90ee90, side: THREE.DoubleSide });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            ground.position.y = -1;
            ground.receiveShadow = true;
            scene.add(ground);
            
            container.addEventListener('click', handleClick);
            window.addEventListener('resize', handleResize);
            
            animate();
        }

        function createCardBack() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 356;
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, 256, 356);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 256, 356);
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 8;
            ctx.strokeRect(12, 12, 232, 332);
            
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            ctx.moveTo(128, 50);
            ctx.lineTo(180, 178);
            ctx.lineTo(128, 306);
            ctx.lineTo(76, 178);
            ctx.closePath();
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(128, 90);
            ctx.lineTo(155, 178);
            ctx.lineTo(128, 266);
            ctx.lineTo(101, 178);
            ctx.closePath();
            ctx.stroke();
            
            const corners = [[40, 40], [216, 40], [40, 316], [216, 316]];
            corners.forEach(([x, y]) => {
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 60px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‚≠ê', 128, 178);
            
            return new THREE.CanvasTexture(canvas);
        }

        function createCardFront(emoji) {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 256, 256);
            ctx.font = 'bold 180px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, 128, 128);
            
            return new THREE.CanvasTexture(canvas);
        }

        function createCard(x, z, animalData, index) {
            const group = new THREE.Group();
            
            const cardGeometry = new THREE.BoxGeometry(2, 0.1, 2.8);
            const cardMaterial = new THREE.MeshPhongMaterial({ color: animalData.color, shininess: 100 });
            const card = new THREE.Mesh(cardGeometry, cardMaterial);
            card.castShadow = true;
            card.receiveShadow = true;
            group.add(card);
            
            const planeGeometry = new THREE.PlaneGeometry(1.8, 2.6);
            
            const backTexture = createCardBack();
            const backMaterial = new THREE.MeshPhongMaterial({ map: backTexture, side: THREE.DoubleSide });
            const back = new THREE.Mesh(planeGeometry, backMaterial);
            back.position.y = 0.06;
            back.rotation.x = -Math.PI / 2;
            group.add(back);
            
            const frontTexture = createCardFront(animalData.emoji);
            const frontMaterial = new THREE.MeshPhongMaterial({ map: frontTexture, side: THREE.DoubleSide });
            const front = new THREE.Mesh(planeGeometry, frontMaterial);
            front.position.y = -0.06;
            front.rotation.x = Math.PI / 2;
            front.visible = false;
            group.add(front);
            
            group.position.set(x, 0, z);
            group.userData = {
                animal: animalData.emoji,
                color: animalData.color,
                index,
                flipped: false,
                matched: false,
                originalY: 0,
                targetRotation: 0,
                currentRotation: 0,
                back,
                front
            };
            
            return group;
        }

        function setupGame() {
            cards.forEach(card => scene.remove(card));
            cards = [];
            matchedPairs = 0;
            flippedCards = [];
            
            const pairs = [...animals, ...animals].sort(() => Math.random() - 0.5);
            
            let index = 0;
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const x = (col - 1.5) * 2.5;
                    const z = (row - 1.5) * 3.2;
                    const card = createCard(x, z, pairs[index], index);
                    scene.add(card);
                    cards.push(card);
                    index++;
                }
            }
        }

        function flipCard(card, show) {
            if (card.userData.matched) return;
            
            card.userData.flipped = show;
            card.userData.targetRotation = show ? Math.PI : 0;
            card.userData.front.visible = show;
            card.userData.back.visible = !show;
        }

        function showMessage(text) {
            const msgEl = document.getElementById('message');
            msgEl.textContent = text;
            msgEl.classList.remove('hidden');
            setTimeout(() => msgEl.classList.add('hidden'), 1000);
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('moves').textContent = moves;
            const timeEl = document.getElementById('time');
            timeEl.textContent = timeLeft + 's';
            timeEl.className = 'stat-value time' + (timeLeft < 15 ? ' warning' : '');
        }

        function checkMatch() {
            if (flippedCards.length !== 2) return;
            
            canFlip = false;
            const [card1, card2] = flippedCards;
            
            moves++;
            updateUI();
            
            if (card1.userData.animal === card2.userData.animal) {
                setTimeout(() => {
                    card1.userData.matched = true;
                    card2.userData.matched = true;
                    card1.userData.targetY = -0.5;
                    card2.userData.targetY = -0.5;
                    
                    matchedPairs++;
                    score += 100;
                    updateUI();
                    showMessage('Match! üéâ');
                    
                    if (matchedPairs === 8) {
                        gameOver = true;
                        clearInterval(timerInterval);
                        document.getElementById('finalStats').innerHTML = 
                            `Final Score: ${score}<br>Moves: ${moves}`;
                        document.getElementById('gameOverOverlay').classList.remove('hidden');
                    }
                    
                    flippedCards = [];
                    canFlip = true;
                }, 500);
            } else {
                setTimeout(() => {
                    flipCard(card1, false);
                    flipCard(card2, false);
                    flippedCards = [];
                    canFlip = true;
                }, 1000);
            }
        }

        function handleClick(event) {
            if (!gameStarted || gameOver || !canFlip) return;
            
            const rect = event.target.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(cards, true);
            
            if (intersects.length > 0) {
                const card = intersects[0].object.parent;
                if (!card.userData.flipped && !card.userData.matched) {
                    flipCard(card, true);
                    flippedCards.push(card);
                    
                    if (flippedCards.length === 2) {
                        checkMatch();
                    }
                }
            }
        }

        function animate() {
            cards.forEach(card => {
                const rotDiff = card.userData.targetRotation - card.userData.currentRotation;
                if (Math.abs(rotDiff) > 0.01) {
                    card.userData.currentRotation += rotDiff * 0.15;
                    card.rotation.y = card.userData.currentRotation;
                }
                
                if (card.userData.matched && card.userData.targetY !== undefined) {
                    const yDiff = card.userData.targetY - card.position.y;
                    if (Math.abs(yDiff) > 0.01) {
                        card.position.y += yDiff * 0.1;
                    }
                }
                
                if (!card.userData.matched) {
                    card.userData.originalY = card.userData.originalY || 0;
                    const targetY = card.userData.flipped ? 0.3 : 0;
                    const yDiff = targetY - card.userData.originalY;
                    if (Math.abs(yDiff) > 0.01) {
                        card.userData.originalY += yDiff * 0.1;
                        card.position.y = card.userData.originalY;
                    }
                }
            });
            
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        function handleResize() {
            const container = document.getElementById('gameCanvas');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function startGame() {
            gameStarted = true;
            gameOver = false;
            score = 0;
            moves = 0;
            timeLeft = 90;
            updateUI();
            
            document.getElementById('startOverlay').classList.add('hidden');
            document.getElementById('gameOverOverlay').classList.add('hidden');
            
            setupGame();
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    gameOver = true;
                    document.getElementById('finalStats').innerHTML = 
                        `Final Score: ${score}<br>Moves: ${moves}`;
                    document.getElementById('gameOverOverlay').classList.remove('hidden');
                    showMessage('Time Up! üòÖ');
                }
            }, 1000);
        }
    </script>
</body>
</html>
